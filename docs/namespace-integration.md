# 看板命名空间集成说明

## 概述

已成功为看板系统添加了自定义命名空间支持，现在用户可以在 MediaWiki 的搜索命名空间选择中看到"看板"选项，并能够专门搜索看板相关的内容。

## 新增的命名空间

### 1. 看板命名空间 (NS_KANBAN = 3000)
- **名称**: "Kanban" / "看板"
- **用途**: 存储看板页面
- **别名**: "看板"
- **权限**: 需要自动确认用户权限才能编辑和移动

### 2. 看板讨论命名空间 (NS_KANBAN_TALK = 3001)
- **名称**: "Kanban_Talk" / "看板讨论"
- **用途**: 存储看板相关的讨论页面
- **别名**: "看板讨论"
- **权限**: 需要自动确认用户权限才能编辑和移动

## 功能特性

### 1. 命名空间搜索集成
- 在 MediaWiki 搜索页面的命名空间选择中会出现"看板"选项
- 选择"看板"命名空间时，只搜索看板相关的内容
- 支持看板名称、描述、任务标题和描述的搜索

### 2. 自定义内容处理
- 每个看板都有对应的命名空间页面
- 页面内容自动从看板数据生成
- 包含看板名称、描述、状态和任务信息

### 3. 权限控制
- 看板页面的访问权限与看板本身的权限一致
- 公开看板：所有用户可访问
- 私有看板：只有所有者和有权限的用户可访问

### 4. 搜索优化
- 看板页面会被索引到 MediaWiki 的搜索系统中
- 支持全文搜索看板内容和任务
- 搜索结果会显示看板的相关信息

## 使用方法

### 1. 搜索看板命名空间
1. 访问 MediaWiki 的搜索页面
2. 在"搜索命名空间"部分选择"看板"
3. 输入搜索关键词
4. 查看搜索结果

### 2. 访问看板页面
- 看板页面的 URL 格式：`Kanban:看板名称`
- 例如：`Kanban:项目看板` 或 `看板:项目看板`

### 3. 搜索特定看板
- 可以直接搜索看板名称
- 系统会自动匹配到对应的看板页面

## 技术实现

### 1. 命名空间定义
在 `extension.json` 中定义了看板命名空间：
```json
"namespaces": [
    {
        "id": 3000,
        "name": "Kanban",
        "subpages": true,
        "canonical": "Kanban",
        "content": false,
        "nonincludable": false,
        "protection": "edit=autoconfirmed,move=autoconfirmed",
        "aliases": ["看板"]
    }
]
```

### 2. 内容处理器
- `KanbanContentHandler`: 处理看板内容模型
- `KanbanContent`: 看板内容类
- `KanbanArticle`: 看板文章类

### 3. 命名空间处理器
- `KanbanNamespaceHandler`: 处理命名空间相关的钩子
- 支持页面存在检查、权限验证、搜索匹配等

### 4. 搜索集成
- 通过多个钩子实现搜索功能
- `SearchableNamespaces`: 将看板命名空间添加到可搜索列表
- `SearchGetNearMatch`: 处理看板名称的精确匹配
- `SearchResultInitFromTitle`: 创建自定义搜索结果

## 文件结构

### 新增文件
```
extensions/KanbanBoard/
├── includes/
│   ├── KanbanNamespaceHandler.php    # 命名空间处理器
│   ├── KanbanContentHandler.php      # 内容处理器
│   ├── KanbanContent.php             # 内容类
│   └── KanbanArticle.php             # 文章类
├── i18n/
│   ├── en.json                       # 英文本地化
│   └── zh-cn.json                    # 中文本地化
└── docs/
    └── namespace-integration.md      # 使用说明
```

### 修改的文件
- `extension.json`: 添加命名空间定义和钩子注册
- `Hooks.php`: 添加命名空间相关钩子
- `SearchHooks.php`: 更新搜索逻辑支持命名空间

## 配置选项

### 1. 命名空间权限
- 默认需要自动确认用户权限
- 可以通过修改 `extension.json` 中的 `protection` 设置调整

### 2. 搜索行为
- 看板命名空间默认包含在搜索中
- 可以通过钩子自定义搜索行为

### 3. 内容生成
- 看板页面内容自动从数据库生成
- 包含看板的基本信息和任务列表

## 扩展性

### 1. 添加新的命名空间
可以通过修改 `extension.json` 添加更多相关的命名空间，如：
- 任务命名空间
- 项目命名空间
- 团队命名空间

### 2. 自定义内容格式
可以通过修改 `KanbanContent` 类来自定义看板页面的内容格式。

### 3. 增强搜索功能
可以通过添加更多钩子来增强搜索功能，如：
- 高级搜索选项
- 搜索结果排序
- 搜索建议

## 注意事项

1. **命名空间ID**: 使用 3000+ 的ID避免与 MediaWiki 核心命名空间冲突
2. **权限设置**: 确保权限设置符合您的安全需求
3. **性能考虑**: 大量看板可能影响搜索性能，建议定期优化
4. **缓存**: 看板页面内容可能需要缓存以提高性能

## 故障排除

### 1. 命名空间不显示
- 检查 `extension.json` 中的命名空间定义
- 确认扩展已正确加载
- 清除 MediaWiki 缓存

### 2. 搜索不工作
- 检查钩子是否正确注册
- 确认数据库连接正常
- 查看错误日志

### 3. 权限问题
- 检查用户权限设置
- 确认看板访问权限配置
- 验证命名空间权限设置

## 未来改进

1. **可视化编辑器**: 为看板页面添加可视化编辑器
2. **模板支持**: 支持看板页面模板
3. **版本控制**: 添加看板内容的版本控制
4. **API集成**: 提供看板命名空间的API接口
