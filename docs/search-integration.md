# 看板任务搜索集成说明

## 概述

本扩展已将看板任务集成到 MediaWiki 的搜索系统中，用户可以通过多种方式搜索和查找看板任务。

## 功能特性

### 1. 全局搜索集成
- 看板任务会自动出现在 MediaWiki 的全局搜索结果中
- 搜索结果包含任务标题、描述、看板名称和状态信息
- 支持按相关度排序，标题匹配的得分更高

### 2. 专门的看板任务搜索页面
- 访问 `Special:KanbanSearch` 页面进行专门的看板任务搜索
- 支持按看板、优先级、状态等条件筛选
- 提供更详细的搜索结果展示

### 3. 权限控制
- 只显示用户有权限访问的看板任务
- 公开看板的任务对所有用户可见
- 私有看板的任务只对所有者或有权限的用户可见

## 使用方法

### 全局搜索
1. 在 MediaWiki 的搜索框中输入关键词
2. 搜索结果中会显示相关的看板任务
3. 点击任务链接可直接跳转到对应的看板页面

### 专门搜索页面
1. 访问 `Special:KanbanSearch` 页面
2. 在搜索表单中输入搜索条件：
   - **搜索词**：任务标题或描述中的关键词
   - **看板**：选择特定看板或搜索所有看板
   - **优先级**：按优先级筛选（紧急、高、中、低）
3. 点击"搜索"按钮查看结果

## 搜索范围

搜索功能会查找以下内容：
- 任务标题 (`kanban_tasks.title`)
- 任务描述 (`kanban_tasks.description`)
- 看板名称 (`kanban_boards.board_name`)
- 状态名称 (`kanban_statuses.status_name`)

## 搜索结果展示

### 全局搜索结果
- 显示任务标题（高亮搜索词）
- 显示任务描述片段
- 显示所属看板和状态信息
- 提供直接跳转到看板的链接

### 专门搜索页面
- 更详细的搜索结果展示
- 显示完整的任务描述
- 显示任务的元数据（优先级、截止日期等）
- 提供更好的筛选和排序功能

## 技术实现

### 搜索钩子
- `SearchResultsAugment`：在全局搜索结果中添加看板任务
- `SpecialSearchResultsPrepend`：在搜索页面顶部显示看板任务提示

### 数据库查询
- 使用 JOIN 查询关联任务、看板和状态表
- 实现权限检查，确保只显示用户有权限的任务
- 支持模糊搜索和条件筛选

### 自定义搜索结果类
- `KanbanSearchResult`：自定义搜索结果对象
- 实现相关度评分算法
- 提供搜索结果的高亮和格式化

## 配置选项

### 搜索结果限制
- 全局搜索最多显示 20 个看板任务结果
- 专门搜索页面最多显示 50 个结果
- 可通过修改代码调整这些限制

### 权限设置
- 公开看板：所有用户可搜索
- 私有看板：只有所有者和有权限的用户可搜索
- 内部看板：根据用户权限决定

## 扩展性

### 添加新的搜索条件
可以通过修改 `SpecialKanbanSearch.php` 中的搜索表单和查询逻辑来添加新的搜索条件，如：
- 按创建时间范围搜索
- 按任务创建者搜索
- 按截止日期搜索

### 自定义搜索结果展示
可以通过修改 CSS 样式和 HTML 模板来自定义搜索结果的展示方式。

### 集成外部搜索引擎
如果需要更强大的搜索功能，可以考虑集成 Elasticsearch 或其他搜索引擎，将看板任务数据同步到外部搜索索引中。

## 注意事项

1. **性能考虑**：大量任务数据可能影响搜索性能，建议定期清理已删除的任务
2. **权限安全**：确保搜索功能不会泄露用户无权访问的任务信息
3. **索引更新**：任务数据更新后，搜索结果可能需要一定时间才能反映最新状态
4. **多语言支持**：当前实现主要支持中文，如需多语言支持需要进一步开发

## 故障排除

### 搜索结果不显示
1. 检查用户是否有相应的看板访问权限
2. 确认任务数据没有被软删除
3. 检查数据库连接是否正常

### 搜索性能问题
1. 考虑在相关字段上添加数据库索引
2. 限制搜索结果数量
3. 使用缓存机制优化重复查询

### 权限问题
1. 检查看板的可见性设置
2. 确认用户的看板权限配置
3. 验证权限检查逻辑是否正确
